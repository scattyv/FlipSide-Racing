#tag WindowBegin Window selectEventWindow   BackColor       =   16777215   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   3   FullScreen      =   False   HasBackColor    =   False   Height          =   305   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   True   MaxWidth        =   32000   MenuBar         =   ""   MenuBarVisible  =   True   MinHeight       =   64   MinimizeButton  =   True   MinWidth        =   64   Placement       =   0   Resizeable      =   True   Title           =   "Please Select the 'Event' you would like to view?"   Visible         =   True   Width           =   800   Begin Listbox ListBox_ST_Events      AutoDeactivate  =   True      AutoHideScrollbars=   True      BehaviorIndex   =   0      Bold            =   ""      Border          =   True      ColumnCount     =   2      ColumnsResizable=   True      ColumnWidths    =   ""      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   2      GridLinesVertical=   2      HasHeading      =   True      HeadingIndex    =   -1      Height          =   271      HelpTag         =   ""      Hierarchical    =   ""      Index           =   2147483648      InitialParent   =   ""      InitialValue    =   "Event Name	Date"      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   False      LockRight       =   False      LockTop         =   True      RequiresSelection=   True      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   12      Top             =   14      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   285      _ScrollOffset   =   0      _ScrollWidth    =   -1      BehaviorIndex   =   0   End   Begin Listbox ListBox_ST_Racers      AutoDeactivate  =   True      AutoHideScrollbars=   True      BehaviorIndex   =   1      Bold            =   ""      Border          =   True      ColumnCount     =   6      ColumnsResizable=   True      ColumnWidths    =   "*,10%,12%,17%,17%,15%"      DataField       =   ""      DataSource      =   ""      DefaultRowHeight=   -1      Enabled         =   True      EnableDrag      =   ""      EnableDragReorder=   ""      GridLinesHorizontal=   2      GridLinesVertical=   2      HasHeading      =   True      HeadingIndex    =   -1      Height          =   271      HelpTag         =   ""      Hierarchical    =   ""      Index           =   2147483648      InitialParent   =   ""      InitialValue    =   "Name	Rank	Laps	Final Time	Best Lap	Average"      Italic          =   ""      Left            =   317      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      RequiresSelection=   True      Scope           =   0      ScrollbarHorizontal=   ""      ScrollBarVertical=   True      SelectionType   =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   12      Top             =   14      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   463      _ScrollOffset   =   0      _ScrollWidth    =   -1      BehaviorIndex   =   1   EndEnd#tag EndWindow#tag WindowCode	#tag Method, Flags = &h0		Sub ShowAllEvents()		  dim rs as RecordSet		  dim d as new date		  rs = G_Database.SQLSelect("SELECT * FROM event_table")		  		  ListBox_ST_Events.DeleteAllRows		  ListBox_ST_Racers.DeleteAllRows		  if rs<>nil then		    while not rs.EOF		      ListBox_ST_Events.AddRow rs.Field("event_name").StringValue		      d = rs.Field("date_added").DateValue		      ListBox_ST_Events.cell(ListBox_ST_Events.LastIndex,1)=d.SQLDateTime		      rs.MoveNext		    wend		  else		    MsgBox "No Events Found!"		  end if		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub ShowRacerData(event_name as string)		  dim rs as RecordSet		  dim event_id as string		  dim racer_ids(-1) as string		  dim name as string		  dim rank as string		  dim average as string		  dim best_lap as string		  dim racers(-1) as raceCar		  		  ListBox_ST_Racers.DeleteAllRows//clean it before hand~		  		  event_id = GetEventID(event_name)//we need to know the event_id based from it's event_name		  racer_ids = getRacerIDs(event_id)//now we need to know the racers based on the event_id		  		  //Now we have the event_id, and all the racer_ids associated with it, any information from other tables will be simple now.		  		  //NAME		  for i as Integer = 0 to UBound(racer_ids)		    name = getRacerName(racer_ids(i))		    ListBox_ST_Racers.AddRow name		  next		  		  'The list box is now initially filled with the names of all the racers, now in the exact same order based on the racer_ids we will fill in the rest of the		  'list box information		  		  //RANK,AVERAGE,BEST_LAP		  for i as Integer = 0 to UBound(racer_ids)		    rs = G_Database.SQLSelect("SELECT * FROM summary_table WHERE racer_id=='"+racer_ids(i)+"' AND event_id=='"+event_id+"'")		    rank = rs.Field("rank").StringValue		    average = rs.Field("average_time").StringValue		    best_lap =  rs.Field("best_lap").StringValue		    ListBox_ST_Racers.cell(i,1)=rank		    ListBox_ST_Racers.cell(i,4)=best_lap		    ListBox_ST_Racers.cell(i,5)=average		  next		  		  //Laps and Time		  		  dim tempCar as raceCar		  for i as integer = 0 to UBound(racer_ids)		    rs = G_Database.SQLSelect("SELECT * FROM laps_table WHERE racer_id=='"+racer_ids(i)+"' AND event_id=='"+event_id+"'")		    if rs<>nil then		      tempCar = new raceCar		      while not rs.EOF		        tempCar.lapCounts.Append rs.Field("lap_number").DoubleValue		        tempCar.lapTimes.Append rs.Field("lap_time").DoubleValue		        tempCar.lagTimes.Append rs.Field("lag_time").DoubleValue		        rs.MoveNext		      wend		    else		      MsgBox "Error finding laps table information"		    end if		    //Find the race car name since we need it from the racer_table		    tempCar.theName=getRacerName(racer_ids(i))//gets the name based from the ID passed		    		    ListBox_ST_Racers.cell(i,2)=cstr(tempCar.lapCounts(UBound(tempCar.lapCounts)))//actually show that it grabbed the highest values in the Listbox		    ListBox_ST_Racers.cell(i,3)=cstr(tempCar.lapTimes(UBound(tempCar.lapTimes)))		    		    racers.Append tempCar//appends the racer info~		  next		  		  UpdateStatisticsScreen(racers)//with the racer array that we created we can pass that to the statistics animator function and it draws the graph for us.		  		  ListBox_ST_Racers.SortedColumn=1//so it sorts with rank~		  ListBox_ST_Racers.Sort()		  		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Sub UpdateStatisticsScreen(racers() as racecar)		  if mainWindow.M_graphTypeSelected="Laps Versus Time" then		    GM_AnimateStatisticsCanvas(racers,mainWindow.M_graphTypeSelected,"Time (seconds)","Laps",mainWindow.statisticsCanvas,"Time_Graph")		  elseif mainWindow.M_graphTypeSelected="Laps Versus Lag" then		    GM_AnimateStatisticsCanvas(racers,mainWindow.M_graphTypeSelected,"Laps","Lag Time (seconds)",mainWindow.statisticsCanvas,"Lag_Graph")		  else		    MsgBox "Graph type for mainWindow not recognized."		  end if		  		End Sub	#tag EndMethod	#tag Method, Flags = &h0		Function GetEventID(event_name as string) As string		  dim rs as RecordSet		  rs = G_Database.SQLSelect("SELECT * FROM event_table WHERE event_name=='"+event_name+"'")		  		  if rs<>nil then		    return rs.Field("event_id").StringValue		  else		    MsgBox "Error, no such event in event_table"		  end if		End Function	#tag EndMethod	#tag Method, Flags = &h0		Function getRacerIDs(event_id as string) As string()		  dim rs as RecordSet		  dim racer_ids(-1) as string		  		  rs = G_Database.SQLSelect("SELECT * FROM event_racer_table WHERE event_id=='"+event_id+"'")		  		  if rs<>nil then		    while not rs.EOF		      racer_ids.Append rs.Field("racer_id").StringValue		      rs.MoveNext		    wend		    return racer_ids		  else		    MsgBox "Error, no records returned in event_racer_table"		  end if		End Function	#tag EndMethod	#tag Method, Flags = &h0		Function getRacerName(racer_id as string) As string		  dim rs as RecordSet		  dim name as string		  rs = G_Database.SQLSelect("SELECT * FROM racer_table WHERE racer_id=='"+racer_id+"'")		  if rs<>nil then		    name=rs.Field("name").StringValue		    return name		  else		    MsgBox "Error finding racer name"		  end if		End Function	#tag EndMethod	#tag Method, Flags = &h0		Function WhatEventIsSelected() As string		  dim row as Integer=0		  dim pass as Boolean = true		  		  for i as Integer=0 to ListBox_ST_Events.ListCount		    if ListBox_ST_Events.Selected(i)=true then		      row=i		      pass=true		      exit		    else		      pass=false		    end if		  next		  if pass=true then		    return ListBox_ST_Events.cell(row,0)		  else		    //in the case that nothing is selected just use the first row and make it selected, but only if there is at least 'that element in the listbox'		    if ListBox_ST_Events.ListCount>0 then		      ListBox_ST_Events.Selected(0)=true		      return ListBox_ST_Events.cell(0,0)		    end if		  end if		  ListBox_ST_Events.SetFocus		  //I need to make it the showRacerData function update mainWindow animateRaceStatistics() function accordingly~		End Function	#tag EndMethod	#tag Note, Name = LICENSE		Copyright 2008 Jeremy Auten				This file is part of Flip Side Racing Software.				Flip Side Racing Software is free software: you can redistribute it and/or modify		it under the terms of the GNU General Public License as published by		the Free Software Foundation, either version 3 of the License, or		(at your option) any later version.				Flip Side Racing Software is distributed in the hope that it will be useful,		but WITHOUT ANY WARRANTY; without even the implied warranty of		MERCHANTABILITY or FITNESS FOR A PARTICULAR PURPOSE.  See the		GNU General Public License for more details.				You should have received a copy of the GNU General Public License		along with Flip Side Racing Software.  If not, see <http://www.gnu.org/licenses/>.	#tag EndNote#tag EndWindowCode#tag Events ListBox_ST_Events	#tag Event		Sub Change()		  ShowRacerData(WhatEventIsSelected())		  		End Sub	#tag EndEvent#tag EndEvents