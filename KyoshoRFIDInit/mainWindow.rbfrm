#tag WindowBegin Window mainWindow   BackColor       =   &hFFFFFF   Backdrop        =   ""   CloseButton     =   True   Composite       =   False   Frame           =   0   FullScreen      =   False   HasBackColor    =   False   Height          =   400   ImplicitInstance=   True   LiveResize      =   True   MacProcID       =   0   MaxHeight       =   32000   MaximizeButton  =   False   MaxWidth        =   32000   MenuBar         =   115349353   MenuBarVisible  =   True   MinHeight       =   400   MinimizeButton  =   True   MinWidth        =   300   Placement       =   0   Resizeable      =   True   Title           =   "Untitled"   Visible         =   True   Width           =   300   Begin PopupMenu PopupMenu_COMPort      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      InitialValue    =   "Click this to select and open the COM port."      Italic          =   ""      Left            =   20      ListIndex       =   0      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   0      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   46      Underline       =   ""      Visible         =   True      Width           =   140   End   Begin StaticText StaticText_SelectCom      Active          =   ""      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   1      TabPanelIndex   =   0      TabStop         =   True      Text            =   "Select COM Port"      TextAlign       =   0      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      Top             =   14      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   100      Window          =   0      _mWindow        =   0   End   Begin kyoshoLapCounter kyoshoLapCounter1      Baud            =   12      Bits            =   3      CTS             =   ""      DTR             =   ""      Height          =   32      Index           =   -2147483648      Left            =   2.0e+1      LockedInPosition=   False      Parity          =   0      processing      =   0      Scope           =   0      Stop            =   0      TabPanelIndex   =   0      Top             =   -8.0e+1      Width           =   32      XON             =   ""   End   Begin PushButton PushButton_Start      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Start Initializing"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   "After you click this button place individual RFID tags on the antenna to initialize them.  Only do 1 tag at a time."      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   2      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   78      Underline       =   ""      Visible         =   True      Width           =   140   End   Begin PushButton PushButton_Stop      AutoDeactivate  =   True      Bold            =   ""      ButtonStyle     =   0      Cancel          =   ""      Caption         =   "Stop Initializing"      Default         =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   ""      LockRight       =   ""      LockTop         =   ""      Scope           =   0      TabIndex        =   3      TabPanelIndex   =   0      TabStop         =   True      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   360      Underline       =   ""      Visible         =   True      Width           =   140   End   Begin Timer Timer_Initialization      Height          =   32      Index           =   -2147483648      Left            =   64      LockedInPosition=   False      Mode            =   0      Period          =   200      Scope           =   0      TabPanelIndex   =   0      Top             =   -80      Width           =   32   End   Begin EditField EditField_Log      AcceptTabs      =   ""      Alignment       =   0      AutoDeactivate  =   True      BackColor       =   &hFFFFFF      Bold            =   ""      Border          =   True      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Format          =   ""      Height          =   238      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   20      LimitText       =   0      LockBottom      =   True      LockedInPosition=   False      LockLeft        =   True      LockRight       =   True      LockTop         =   True      Mask            =   ""      Multiline       =   True      Password        =   ""      ReadOnly        =   ""      Scope           =   0      ScrollbarHorizontal=   ""      ScrollbarVertical=   True      Styled          =   ""      TabIndex        =   4      TabPanelIndex   =   0      TabStop         =   True      Text            =   ""      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   110      Underline       =   ""      UseFocusRing    =   True      Visible         =   True      Width           =   260   End   Begin Label Label1      AutoDeactivate  =   True      Bold            =   ""      DataField       =   ""      DataSource      =   ""      Enabled         =   True      Height          =   20      HelpTag         =   ""      Index           =   -2147483648      InitialParent   =   ""      Italic          =   ""      Left            =   200      LockBottom      =   ""      LockedInPosition=   False      LockLeft        =   True      LockRight       =   ""      LockTop         =   True      Multiline       =   ""      Scope           =   0      Selectable      =   False      TabIndex        =   5      TabPanelIndex   =   0      Text            =   "Version 2"      TextAlign       =   2      TextColor       =   &h000000      TextFont        =   "System"      TextSize        =   0      TextUnit        =   0      Top             =   360      Transparent     =   False      Underline       =   ""      Visible         =   True      Width           =   80   EndEnd#tag EndWindow#tag WindowCode	#tag Method, Flags = &h0		Sub logMessage(message as String)		  //Write new data to the editfield used for a log		  		  //Increment line number		  lineNumber = lineNumber + 1		  EditField_Log.AppendText(str(lineNumber) + " " + message + EndOfLine)		End Sub	#tag EndMethod	#tag Property, Flags = &h0		block0 As String = "ACAE53E0"	#tag EndProperty	#tag Property, Flags = &h0		block1 As String = "00000000"	#tag EndProperty	#tag Property, Flags = &h0		block2 As String = "01160908"	#tag EndProperty	#tag Property, Flags = &h0		lineNumber As Integer = 0	#tag EndProperty	#tag Property, Flags = &h0		mode As Integer = 0	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Populated when a new UID is detected		#tag EndNote		newUID As String = "0000000000000000"	#tag EndProperty	#tag Property, Flags = &h0		#tag Note			Populated after a new uid is written to.  This is so if a tag stays in the field we do not keep writing to it over and over.		#tag EndNote		oldUID As String = "0000000000000000"	#tag EndProperty#tag EndWindowCode#tag Events PopupMenu_COMPort	#tag Event		Sub Open()		  dim i, count as Integer		  count = System.SerialPortCount		  		  for i = 0 to count - 1		    PopupMenu_COMPort.AddRow( System.SerialPort( i ).Name )		  next		End Sub	#tag EndEvent	#tag Event		Sub Change()		  //Make sure we have something selected		  if me.ListIndex <> 0 then		    		    kyoshoLapCounter1.Close		    		    //Is at -1 because we added a description as entry 0 in the list		    kyoshoLapCounter1.SerialPort = System.SerialPort( me.ListIndex - 1)		    		    if not kyoshoLapCounter1.Open then		      ' If we couldn't open the port, then bail out		      MsgBox "Could not open " + System.SerialPort( me.ListIndex -1 ).Name		      logMessage("Could not open " + System.SerialPort( me.ListIndex -1 ).Name)		    else		      logMessage("COM port opened")		      		    end if		    		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events kyoshoLapCounter1	#tag Event		Sub DetectedUIDs(uids() as string)		  		  //Check to see if this is a new UID or not		  //If UID is new write it to the newUID property so it can be processed if initialization is running		  if uids(0) = oldUID then		    //same UID detected do nothing		  else		    //New uid detected we may need to do something		    logMessage("New UID detected, " + uids(0))		    oldUID = newUID		    newUID = uids(0)		    		  end if		End Sub	#tag EndEvent	#tag Event		Sub logging(message as string)		  logMessage(Message)		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton_Start	#tag Event		Sub Action()		  //Send command to make sure polling mode is off		  kyoshoLapCounter1.Write(ChrB(&h32) + ChrB(&h03) + ChrB(&h31))		  		  Timer_Initialization.Mode = 2		  logMessage("Timer started")		End Sub	#tag EndEvent#tag EndEvents#tag Events PushButton_Stop	#tag Event		Sub Action()		  Timer_Initialization.Mode = 0		  logMessage("Timer stopped")		End Sub	#tag EndEvent#tag EndEvents#tag Events Timer_Initialization	#tag Event		Sub Action()		  //Check to see if we have a new UID if so then we need to initialize it		  		  		  if newUID = oldUID then		    //no new ID, we can return		    		    kyoshoLapCounter1.inventory		    return		  else		    //clear out block 1		    block1 = "00000000"		    		    //We got a new UID lets program it		    logMessage("Initializing UID " + newUID)		    block1 = midb(newUID,3,2) + midb(newUID,11,2) + midb(newUID,13,2) + midb(newUID,15,2)		    if block1 = "00000000" then		      //Something went wrong abort		      logMessage("Block 1 calculation error")		      return		    else		      //We got a valid calculation		      //We can continue		      		      select case mode		        		      case 0		        logMessage("Block 1 calculated as " + block1)		        		        kyoshoLapCounter1.writeToRFID(0,block0,newUID)		        kyoshoLapCounter1.XmitWait		        mode = mode + 1		      case 1		        kyoshoLapCounter1.writeToRFID(1,block1,newUID)		        kyoshoLapCounter1.XmitWait		        mode = mode + 1		      case 2		        kyoshoLapCounter1.writeToRFID(2,block2,newUID)		        kyoshoLapCounter1.XmitWait		        		        mode = 0		        oldUID = newUID		        logMessage("Initialization complete")		        		      end select		    end if		    		  end if		  		  if mode = 0 then		    kyoshoLapCounter1.inventory		  end if		End Sub	#tag EndEvent#tag EndEvents#tag Events EditField_Log	#tag Event		Sub Open()		  me.AppendText("WARNING: only use this with generic tags" + EndOfLine)		  me.AppendText("Step 1: Select a COM port" + EndOfLine)		  me.AppendText("Step 2: Click the Start Initializing button" + EndOfLine)		  me.AppendText("Step 3: Place one RFID tag at a time on the antenna until it says Initialization Complete" + EndOfLine)		End Sub	#tag EndEvent#tag EndEvents